# Секреты и переменные для GitHub Actions

Куда вносить: репозиторий на GitHub → **Settings** → **Secrets and variables** → **Actions**.

---

## Секреты (Secrets)

Используются в workflow для доступа к реестру и к серверу деплоя.

### Для деплоя по SSH (обязательны, если включён job `deploy`)

| Имя секрета        | Назначение                    | Как получить / создать |
|--------------------|-------------------------------|-------------------------|
| **`SSH_HOST`**     | Хост сервера (IP или домен)   | IP или hostname сервера, куда деплоится приложение (например `123.45.67.89` или `deploy.example.com`). |
| **`SSH_USER`**     | Пользователь для SSH         | Имя пользователя на сервере (например `deploy` или `root`). Лучше отдельный пользователь с ограниченными правами. |
| **`SSH_PRIVATE_KEY`** | Приватный SSH-ключ        | 1. На своей машине: `ssh-keygen -t ed25519 -C "github-actions" -f deploy_key -N ""` (или `-t ecdsa`). 2. Публичный ключ добавить на сервер: `cat deploy_key.pub >> ~/.ssh/authorized_keys` (в домашней директории `SSH_USER`). 3. В GitHub Secret вставить **целиком** содержимое файла `deploy_key` (включая строки `-----BEGIN ... KEY-----` и `-----END ... KEY-----`). |

### Для pull образа на сервере (GHCR)

| Имя секрета   | Назначение                              | Как получить |
|---------------|----------------------------------------|--------------|
| **`GHCR_PAT`** | Токен для чтения образов из GitHub Container Registry | 1. GitHub → **Settings** (профиль) → **Developer settings** → **Personal access tokens** → **Tokens (classic)** или **Fine-grained tokens**. 2. Создать токен с правом **read:packages** (Classic) или для репозитория/пакета — **Contents: Read** и **Packages: Read** (Fine-grained). 3. Скопировать токен один раз и вставить в репозиторный Secret **GHCR_PAT**. На сервере этот токен передаётся в `docker login ghcr.io`, чтобы можно было делать `docker pull`. |

---

## Переменные (Variables, не секреты)

Можно задать в **Variables** (видны в логах, не для паролей).

| Переменная       | Назначение                    | Обязательность |
|------------------|-------------------------------|----------------|
| **`VITE_API_URL`** | URL бэкенда для фронта при сборке | Опционально. Если не задана, в приложении будет пустой/дефолтный URL. |
| **`DEPLOY_ENABLED`** | Включить ли job деплоя | Опционально. По умолчанию деплой запускается. Чтобы только собирать и пушить образ без деплоя, задать значение **false**. |

---

## Окружение (Environment) для деплоя

В workflow используется `environment: production`. Нужно его создать:

1. Репозиторий → **Settings** → **Environments** → **New environment**.
2. Имя: **production** (как в `environment: production` в YAML).
3. При желании: **Required reviewers** — тогда деплой запустится только после подтверждения.

Если окружение не создать, GitHub создаст его при первом запуске job’а с `environment: production`.

---

## Краткий чеклист

- [ ] **SSH_HOST** — IP или домен сервера.
- [ ] **SSH_USER** — пользователь SSH на сервере.
- [ ] **SSH_PRIVATE_KEY** — полное содержимое приватного ключа; публичный ключ добавлен в `authorized_keys` на сервере.
- [ ] **GHCR_PAT** — Personal Access Token с правом read:packages (для `docker pull` на сервере).
- [ ] (По желанию) **Variables** → **VITE_API_URL** — URL API для сборки фронта.
- [ ] Окружение **production** создано в Settings → Environments (или будет создано при первом запуске).

Если деплой не нужен — можно удалить job **deploy** из `.github/workflows/build-deploy.yml`; тогда секреты **SSH_*** и **GHCR_PAT** не требуются.
