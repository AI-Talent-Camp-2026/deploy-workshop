# Спецификация входных данных для CI/CD (GitHub Actions)

Чтобы написать пайплайн, нужны следующие данные.

---

## 1. Реестр образов (Container Registry)

| Параметр | Описание | Пример |
|----------|----------|--------|
| **Тип реестра** | Какой использовать | `ghcr.io` (GitHub Container Registry), `docker.io` (Docker Hub), или свой (e.g. `registry.example.com`) |
| **Полный адрес реестра** | Базовый URL без образа | `ghcr.io`, `docker.io` |
| **Имя образа** | Репозиторий/имя образа в реестре | `ghcr.io/OWNER/REPO`, `docker.io/username/workshop-itmo` |

---

## 2. Секреты (GitHub Secrets)

Указываются в **Settings → Secrets and variables → Actions** репозитория.

| Secret | Назначение | Когда нужен |
|--------|------------|-------------|
| **`REGISTRY_TOKEN`** или **`GITHUB_TOKEN`** | Токен для пуша в реестр (логин/пароль или PAT) | Всегда при пуше образов |
| **`REGISTRY_USERNAME`** | Логин в реестр | Для Docker Hub и сторонних реестров; для GHCR можно не задавать (используется `GITHUB_ACTOR`) |
| **`REGISTRY_PASSWORD`** | Пароль/токен реестра | Для Docker Hub и сторонних реестров; для GHCR — `GITHUB_TOKEN` или отдельный PAT с `write:packages` |

Для **GHCR** достаточно:
- Включить в workflow разрешение `packages: write`.
- Использовать встроенный `GITHUB_TOKEN` (создаётся автоматически) — отдельный секрет не обязателен.

---

## 3. Переменные сборки образа

| Переменная | Описание | Обязательность |
|------------|----------|----------------|
| **`VITE_API_URL`** | URL бэкенда для фронта (прокидывается в Vite при сборке) | Опционально; можно задать в GitHub Variables или в шаге build |

---

## 4. Триггеры и окружения

| Параметр | Описание | Пример |
|----------|----------|--------|
| **Ветки для запуска** | На каких событиях/ветках запускать | `push` в `main`/`master`, `push` в теги `v*`, pull_request в `main` |
| **Ветка по умолчанию** | Основная ветка для деплоя/тегов | `main` или `master` |
| **Окружения (environments)** | Нужны ли `staging`, `production` в GitHub | Да/нет; если да — имена и опциональная защита (approval) |

---

## 5. Шаги пайплайна (что включить)

Отметь, что должно входить в пайплайн:

- [ ] **Lint** — `npm run lint`
- [ ] **Build приложения** — `npm run build` (проверка, что проект собирается)
- [ ] **Сборка Docker-образа** — `docker build`
- [ ] **Пуш образа в реестр** — при push в определённую ветку или при создании тега
- [ ] **Деплой** — куда и как (K8s, Docker Swarm, SSH, другой сервис) — опиши отдельно, если нужен

---

## 6. Деплой (если нужен автоматический деплой)

| Параметр | Описание |
|----------|----------|
| **Куда деплоить** | Сервер (IP/hostname), Kubernetes (cluster, namespace), облачный сервис (Cloud Run, ECS, etc.) |
| **Как деплоить** | SSH + docker pull + docker run; kubectl/helm; облачная CLI (gcloud, aws, etc.) |
| **Секреты для деплоя** | SSH key, kubeconfig, облачные ключи — имена секретов в GitHub |

---

## Пример заполнения (GHCR + только build & push)

- **Тип реестра:** GitHub Container Registry (ghcr.io)
- **Имя образа:** `ghcr.io/<OWNER>/workshop-itmo` (OWNER — логин организации или пользователя GitHub)
- **Секреты:** не требуются (используем `GITHUB_TOKEN` с `packages: write`)
- **Переменные:** `VITE_API_URL` — опционально, через GitHub Variables
- **Триггеры:** push в `main` — lint + build; при теге `v*` — сборка образа и пуш в GHCR
- **Шаги:** Lint, Build, Docker build & push при теге

---

После заполнения этой спецификации (или ответов по пунктам) можно перейти к написанию конкретного workflow в `.github/workflows/`.